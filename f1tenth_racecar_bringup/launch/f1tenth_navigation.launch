<launch>
    <arg name="map_name" default="map"/>
    <arg name="ll2_map_name" default="map"/>

    <node pkg="map_server" name="map_server" type="map_server" args="$(find f1tenth_racecar_bringup)/map/$(arg map_name).yaml"/>
    
    <node pkg="tf" type="static_transform_publisher" name="earth_broadcaster" args="0 0 0 1.7977 0 0 earth map 100" />

    <node name="f1tenth_ll2_global_planner" pkg="f1tenth_ll2_global_planner" type="f1tenth_ll2_global_planner_node" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/f1tenth_ll2_global_planner.yaml"/>
        <param name="map_file" value="$(find f1tenth_ll2_global_planner)/map/$(arg ll2_map_name).osm" />
    </node>

    <node name="amcl" pkg="amcl" type="amcl" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/amcl.yaml"/>
        <remap from="scan" to="scan"/>
    </node>

    <node name="costmap_generator" pkg="costmap_generator" type="costmap_generator_node" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/costmap_generator.yaml"/>
        <remap from="scan" to="scan"/>
    </node>

    <node name="local_planner" pkg="local_planner" type="local_planner_node" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/local_planner.yaml"/>
        <remap from="global_path" to="global_path"/>
        <remap from="odom" to="odom"/>
        <remap from="drive_feedback" to="drive_safe"/>
    </node>

    <node name="drive_controller" pkg="drive_controller" type="drive_controller_node" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/drive_controller.yaml"/>
        <remap from="trajectory" to="local_trajectory"/>
        <remap from="odom" to="odom"/>
    </node>

    <node name="drive_mode_selector" pkg="drive_mode_selector" type="drive_mode_selector_node" output="screen">
        <remap from="drive_mode" to="drive_mode"/>
        <remap from="drive_joy" to="drive_joy"/>
        <remap from="drive_auto" to="drive_auto"/>
    </node>

    <node name="collision_warning_system" pkg="collision_warning_system" type="collision_warning_system_node" output="screen">
        <rosparam command="load" file="$(find f1tenth_racecar_bringup)/config/collision_warning_system.yaml"/>
        <remap from="odom" to="odom"/>
        <remap from="drive" to="drive_safe"/>
    </node>

    <node name="safety_controller" pkg="safety_controller" type="safety_controller_node" output="screen">
        <remap from="odom" to="odom"/>
        <remap from="drive_in" to="drive_selected"/>
    </node>
</launch>
